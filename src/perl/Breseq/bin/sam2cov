#!/usr/bin/env perl

###
# Pod Documentation
###

=head1 NAME

sam2html

=head1 SYNOPSIS

Usage: sam2html [-o output] database.bam reference.fasta REL606:1-100

Create an HTML alignment of a region. Region must not be too big!

=head1 DESCRIPTION

=over

=back

=head1 AUTHOR

Jeffrey Barrick
<barrick@msu.edu>

=head1 COPYRIGHT

Copyright 2009.  All rights reserved.

=cut

###
# End Pod Documentation
###


use strict;
use Data::Dumper;

use FindBin;
use lib $FindBin::Bin;

#### Paths to Locally Installed Modules ####
use lib $FindBin::Bin . "/../lib/perl5";
use lib $FindBin::Bin . "/../lib/perl5/site_perl";

use CGI qw/:standard/;

use Breseq::CoverageOutput;

#Get options
use Getopt::Long;
use Pod::Usage;
my ($help, $man, $verbose);
my $output_file;
GetOptions(
	'help|?' => \$help, 'man' => \$man,
	'output|o=s' => \$output_file,
	'verbose|v' => \$verbose,
) or pod2usage(2);
pod2usage(1) if $help;
pod2usage(-exitstatus => 0, -verbose => 2) if $man;

my ($bam_path, $fasta_path, @regions) = @ARGV;

die "No regions defined.\n" if (scalar @regions == 0);
die "No BAM file defined.\n" if (!$bam_path);
die "No fasta file defined.\n" if (!$fasta_path);

foreach my $region (@regions)
{
	my $co = Breseq::CoverageOutput->new(-fasta => $fasta_path, -bam => $bam_path );
	$co->plot_coverage($region, undef, {verbose=>$verbose, resolution=>600});
}
